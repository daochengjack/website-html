generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ========================================
// User Management & Authentication
// ========================================

model Role {
  id          String    @id @default(cuid())
  slug        String    @unique
  name        String
  description String?
  isSystem    Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  userRoles UserRole[]

  @@index([slug])
  @@map("roles")
}

model User {
  id            String                 @id @default(cuid())
  email         String                 @unique
  name          String
  passwordHash  String
  isActive      Boolean                @default(true)
  lastLoginAt   DateTime?
  createdAt     DateTime               @default(now())
  updatedAt     DateTime               @updatedAt

  roles             UserRole[]
  sessions          UserSession[]
  passwordResets    PasswordResetToken[]
  inquiryMessages   InquiryMessage[]
  assignedInquiries Inquiry[]          @relation("UserAssignments")

  @@index([email])
  @@index([isActive])
  @@map("users")
}

model UserRole {
  id        String   @id @default(cuid())
  userId    String
  roleId    String
  assignedAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  role Role @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([userId, roleId])
  @@index([userId])
  @@index([roleId])
  @@map("user_roles")
}

model UserSession {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
  @@map("user_sessions")
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
  @@map("password_reset_tokens")
}

// ========================================
// Product Categories (Self-referencing tree)
// ========================================

model ProductCategory {
  id          String   @id @default(cuid())
  slug        String   @unique
  parentId    String?
  path        String   @unique
  position    Int      @default(0)
  isPublished Boolean  @default(true)
  showInMenu  Boolean  @default(true)
  iconUrl     String?
  imageUrl    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  parent       ProductCategory?  @relation("CategoryHierarchy", fields: [parentId], references: [id], onDelete: SetNull)
  children     ProductCategory[] @relation("CategoryHierarchy")
  translations ProductCategoryTranslation[]
  products     Product[]

  @@index([parentId])
  @@index([position])
  @@index([isPublished])
  @@map("product_categories")
}

model ProductCategoryTranslation {
  id              String   @id @default(cuid())
  categoryId      String
  locale          String
  name            String
  description     String?  @db.Text
  metaTitle       String?
  metaDescription String?  @db.Text
  ogImage         String?
  isPublished     Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  category ProductCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([categoryId, locale])
  @@index([locale])
  @@index([categoryId])
  @@map("product_category_translations")
}

// ========================================
// Products & Related Entities
// ========================================

enum ProductStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

model Product {
  id             String        @id @default(cuid())
  sku            String        @unique
  categoryId     String?
  status         ProductStatus @default(DRAFT)
  isFeatured     Boolean       @default(false)
  position       Int           @default(0)
  publishedAt    DateTime?
  archivedAt     DateTime?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  category       ProductCategory?      @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  translations   ProductTranslation[]
  images         ProductImage[]
  assets         ProductAsset[]
  tagAssignments ProductTagOnProduct[]
  specifications ProductSpecification[]
  related        ProductRelated[]      @relation("ProductToRelated")
  relatedBy      ProductRelated[]      @relation("RelatedToProduct")
  faqs           ProductFaq[]
  inquiries      Inquiry[]

  @@index([categoryId])
  @@index([status])
  @@index([isFeatured])
  @@index([position])
  @@index([publishedAt])
  @@map("products")
}

model ProductTranslation {
  id               String   @id @default(cuid())
  productId        String
  locale           String
  slug             String
  name             String
  shortDescription String? @db.Text
  description      String? @db.Text
  features         String? @db.Text
  applications     String? @db.Text
  metaTitle        String?
  metaDescription  String? @db.Text
  ogImage          String?
  isPublished      Boolean  @default(false)
  publishedAt      DateTime?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, locale])
  @@unique([locale, slug])
  @@index([locale])
  @@index([slug])
  @@index([productId])
  @@map("product_translations")
}

model ProductImage {
  id        String   @id @default(cuid())
  productId String
  url       String
  altText   String?
  position  Int      @default(0)
  isPrimary Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([position])
  @@index([isPrimary])
  @@map("product_images")
}

model ProductAsset {
  id        String   @id @default(cuid())
  productId String
  locale    String?
  type      String
  url       String
  fileName  String
  fileSize  Int?
  mimeType  String?
  title     String?
  position  Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([locale])
  @@index([type])
  @@map("product_assets")
}

model ProductTag {
  id          String   @id @default(cuid())
  slug        String   @unique
  isPublished Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  translations   ProductTagTranslation[]
  productMappings ProductTagOnProduct[]

  @@index([slug])
  @@index([isPublished])
  @@map("product_tags")
}

model ProductTagTranslation {
  id          String   @id @default(cuid())
  tagId       String
  locale      String
  name        String
  isPublished Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  tag ProductTag @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([tagId, locale])
  @@index([locale])
  @@map("product_tag_translations")
}

model ProductTagOnProduct {
  id        String   @id @default(cuid())
  productId String
  tagId     String
  createdAt DateTime @default(now())

  product Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  tag     ProductTag @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([productId, tagId])
  @@index([productId])
  @@index([tagId])
  @@map("product_tag_products")
}

model ProductSpecification {
  id        String   @id @default(cuid())
  productId String
  locale    String?
  key       String
  value     String   @db.Text
  unit      String?
  position  Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([locale])
  @@unique([productId, key, locale])
  @@map("product_specifications")
}

model ProductRelated {
  id               String   @id @default(cuid())
  productId        String
  relatedProductId String
  type             String   @default("related")
  position         Int      @default(0)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  product        Product @relation("ProductToRelated", fields: [productId], references: [id], onDelete: Cascade)
  relatedProduct Product @relation("RelatedToProduct", fields: [relatedProductId], references: [id], onDelete: Cascade)

  @@unique([productId, relatedProductId])
  @@index([productId])
  @@index([relatedProductId])
  @@index([type])
  @@map("product_related")
}

model ProductFaq {
  id        String   @id @default(cuid())
  productId String
  locale    String
  question  String   @db.Text
  answer    String   @db.Text
  position  Int      @default(0)
  isPublished Boolean @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([locale])
  @@map("product_faqs")
}

// ========================================
// Content: Banners, Homepage, Testimonials
// ========================================

model Banner {
  id             String   @id @default(cuid())
  locale         String
  title          String?
  subtitle       String?
  imageUrl       String
  mobileImageUrl String?
  linkUrl        String?
  linkText       String?
  position       Int      @default(0)
  isPublished    Boolean  @default(true)
  startsAt       DateTime?
  endsAt         DateTime?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([locale])
  @@index([position])
  @@index([isPublished])
  @@index([startsAt])
  @@index([endsAt])
  @@map("banners")
}

model HomepageSection {
  id           String   @id @default(cuid())
  locale       String
  sectionKey   String
  title        String?
  subtitle     String?
  content      String?  @db.Text
  imageUrl     String?
  linkUrl      String?
  linkText     String?
  position     Int      @default(0)
  isPublished  Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([locale, sectionKey])
  @@index([locale])
  @@index([sectionKey])
  @@index([position])
  @@index([isPublished])
  @@map("homepage_sections")
}

model ClientLogo {
  id          String   @id @default(cuid())
  name        String
  logoUrl     String
  websiteUrl  String?
  position    Int      @default(0)
  isPublished Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([position])
  @@index([isPublished])
  @@map("client_logos")
}

model Testimonial {
  id            String   @id @default(cuid())
  locale        String
  clientName    String
  clientRole    String?
  clientCompany String?
  content       String   @db.Text
  rating        Int?
  imageUrl      String?
  position      Int      @default(0)
  isPublished   Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([locale])
  @@index([position])
  @@index([isPublished])
  @@map("testimonials")
}

// ========================================
// Content: News & Blog
// ========================================

model NewsArticle {
  id               String   @id @default(cuid())
  slug             String   @unique
  isPublished      Boolean  @default(false)
  publishedAt      DateTime?
  featuredImageUrl String?
  authorName       String?
  viewCount        Int      @default(0)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  translations NewsArticleTranslation[]

  @@index([slug])
  @@index([isPublished])
  @@index([publishedAt])
  @@map("news_articles")
}

model NewsArticleTranslation {
  id              String   @id @default(cuid())
  articleId       String
  locale          String
  slug            String
  title           String
  excerpt         String?  @db.Text
  content         String   @db.Text
  metaTitle       String?
  metaDescription String?  @db.Text
  ogImage         String?
  isPublished     Boolean  @default(false)
  publishedAt     DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  article NewsArticle @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@unique([articleId, locale])
  @@unique([locale, slug])
  @@index([locale])
  @@index([slug])
  @@map("news_article_translations")
}

model BlogPost {
  id               String   @id @default(cuid())
  slug             String   @unique
  categorySlug     String?
  isPublished      Boolean  @default(false)
  publishedAt      DateTime?
  featuredImageUrl String?
  authorName       String?
  viewCount        Int      @default(0)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  translations BlogPostTranslation[]

  @@index([slug])
  @@index([categorySlug])
  @@index([isPublished])
  @@index([publishedAt])
  @@map("blog_posts")
}

model BlogPostTranslation {
  id              String   @id @default(cuid())
  postId          String
  locale          String
  slug            String
  title           String
  excerpt         String?  @db.Text
  content         String   @db.Text
  tags            String[]
  metaTitle       String?
  metaDescription String?  @db.Text
  ogImage         String?
  isPublished     Boolean  @default(false)
  publishedAt     DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  post BlogPost @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([postId, locale])
  @@unique([locale, slug])
  @@index([locale])
  @@index([slug])
  @@map("blog_post_translations")
}

// ========================================
// Content: Downloads & Static Pages
// ========================================

model DownloadDocument {
  id            String   @id @default(cuid())
  locale        String
  title         String
  description   String?  @db.Text
  categoryKey   String?
  fileUrl       String
  fileName      String
  fileSize      Int?
  mimeType      String?
  thumbnailUrl  String?
  downloadCount Int      @default(0)
  isPublished   Boolean  @default(true)
  position      Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([locale])
  @@index([categoryKey])
  @@index([isPublished])
  @@index([position])
  @@map("download_documents")
}

model StaticPage {
  id          String   @id @default(cuid())
  slug        String   @unique
  pageKey     String   @unique
  isPublished Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  translations StaticPageTranslation[]

  @@index([slug])
  @@index([pageKey])
  @@index([isPublished])
  @@map("static_pages")
}

model StaticPageTranslation {
  id              String   @id @default(cuid())
  pageId          String
  locale          String
  slug            String
  title           String
  content         String   @db.Text
  metaTitle       String?
  metaDescription String?  @db.Text
  ogImage         String?
  isPublished     Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  page StaticPage @relation(fields: [pageId], references: [id], onDelete: Cascade)

  @@unique([pageId, locale])
  @@unique([locale, slug])
  @@index([locale])
  @@index([slug])
  @@map("static_page_translations")
}

model CatalogueItem {
  id           String   @id @default(cuid())
  locale       String
  title        String
  description  String?  @db.Text
  categoryKey  String?
  pdfUrl       String
  coverImageUrl String?
  pageCount    Int?
  fileSize     Int?
  year         Int?
  isPublished  Boolean  @default(true)
  position     Int      @default(0)
  viewCount    Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([locale])
  @@index([categoryKey])
  @@index([isPublished])
  @@index([position])
  @@index([year])
  @@map("catalogue_items")
}

// ========================================
// Engagement: Inquiries, Contact, Newsletter
// ========================================

model InquiryStatus {
  id          String   @id @default(cuid())
  slug        String   @unique
  name        String
  description String?  @db.Text
  color       String?
  position    Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  inquiries Inquiry[]

  @@index([slug])
  @@index([isActive])
  @@map("inquiry_statuses")
}

model Inquiry {
  id             String   @id @default(cuid())
  refNumber      String   @unique
  statusId       String
  customerName   String
  customerEmail  String
  customerPhone  String?
  companyName    String?
  productId      String?
  subject        String
  initialMessage String   @db.Text
  priority       Int      @default(0)
  assignedToId   String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  status    InquiryStatus @relation(fields: [statusId], references: [id], onDelete: Restrict)
  product   Product?      @relation(fields: [productId], references: [id], onDelete: SetNull)
  assignee  User?         @relation("UserAssignments", fields: [assignedToId], references: [id], onDelete: SetNull)
  messages  InquiryMessage[]

  @@index([statusId])
  @@index([customerEmail])
  @@index([priority])
  @@index([assignedToId])
  @@index([productId])
  @@index([createdAt])
  @@map("inquiries")
}

model InquiryMessage {
  id          String   @id @default(cuid())
  inquiryId   String
  userId      String?
  senderName  String
  senderEmail String?
  message     String   @db.Text
  isInternal  Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  inquiry Inquiry @relation(fields: [inquiryId], references: [id], onDelete: Cascade)
  user    User?   @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([inquiryId])
  @@index([userId])
  @@index([createdAt])
  @@map("inquiry_messages")
}

model ContactSubmission {
  id          String   @id @default(cuid())
  name        String
  email       String
  phone       String?
  companyName String?
  subject     String?
  message     String   @db.Text
  isRead      Boolean  @default(false)
  source      String?
  ipAddress   String?
  userAgent   String?  @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([email])
  @@index([isRead])
  @@index([createdAt])
  @@map("contact_submissions")
}

model NewsletterSignup {
  id             String   @id @default(cuid())
  email          String   @unique
  name           String?
  locale         String?
  isActive       Boolean  @default(true)
  isVerified     Boolean  @default(false)
  verifiedAt     DateTime?
  unsubscribedAt DateTime?
  source         String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([email])
  @@index([isActive])
  @@index([isVerified])
  @@index([locale])
  @@map("newsletter_signups")
}
